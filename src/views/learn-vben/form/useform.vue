<template>
  <PageWrapper contentBackground contentFullHeight>
    <template #title><BasicTitle :span="true">useForm ÊñπÂºè</BasicTitle></template>
    <template #headerContent>Ë°®ÂçïÁªÑ‰ª∂</template>
    <div class="main">
      <BasicForm :schemas="schemas" @register="register" @submit="handleSubmit">
        <template #customSlot="{ model, field }">
          <a-input v-model:value="model[field]" />
        </template>
        <template #formHeader> Ë°®ÂçïÈ°∂ÈÉ®ÊèíÊßΩ </template>
        <template #formFooter> Ë°®ÂçïÂ∫ïÈÉ®ÊèíÊßΩ </template>
      </BasicForm>
      <SearchAddress ref="searchAddressRef" @confirm="onSearchAddressConfirm" />
    </div>
  </PageWrapper>
</template>

<script lang="ts">
  /** FormSchema
   *    field Â≠óÊÆµÂêç
   *    label Ê†áÁ≠æÂêç
   *    labelWidth Ê†áÁ≠æÂÆΩÂ∫¶, Ë¶ÜÁõñÁªü‰∏ÄËÆæÁΩÆÁöÑ labelWidth
   *    subLabel ‰∫åÁ∫ßÊ†áÁ≠æ
   *    suffix ÁªÑ‰ª∂ÂêéÈù¢ÂÜÖÂÆπ
   *    helpMessage Ê†áÁ≠æÂè≥‰æßÊ∏©È¶®ÊèêÁ§∫
   *    helpComponentProps Ê†áÁ≠æÂè≥‰æßÊ∏©È¶®ÊèêÁ§∫ props
   *    changeEvent Ë°®ÂçïÊõ¥Êñ∞‰∫ã‰ª∂Âêç *
   *    component ÁªÑ‰ª∂Á±ªÂûã *
   *         'Input'| 'InputGroup'| 'InputPassword'| 'InputSearch'| 'InputTextArea'| 'InputNumber'| 'InputCountDown'| 'Select'| 'ApiSelect'| 'TreeSelect'| 'RadioButtonGroup'| 'RadioGroup'| 'Checkbox'| 'CheckboxGroup'| 'AutoComplete'| 'Cascader'| 'DatePicker'| 'MonthPicker'| 'RangePicker'| 'WeekPicker'| 'TimePicker'| 'Switch'| 'StrengthMeter'| 'Upload'| 'IconPicker'| 'Render'| 'Slider'| 'Rate'| 'Divider';  // v2.7.2Êñ∞Â¢û
   *          * ÈúÄË¶ÅËá™Ë°åÊ∑ªÂä†ÁªÑ‰ª∂ https://doc.vvbin.cn/components/form.html#%E8%87%AA%E8%A1%8C%E6%B7%BB%E5%8A%A0%E9%9C%80%E8%A6%81%E7%9A%84%E7%BB%84%E4%BB%B6%E7%B1%BB%E5%9E%8B
   *    componentProps ÊâÄÊ∏≤ÊüìÁªÑ‰ª∂ÁöÑ props *
   *    rules Ê£ÄÈ™åËßÑÂàô *
   *    required ÁÆÄÂåñÊ£ÄÈ™åËßÑÂàô ‰∏∫ trueÊó∂ ÂàôËΩ¨ÂåñÊàê [{required:true}]
   *    rulesMessageJoinLabel Ê£ÄÈ™åËßÑÂàôÊòØÂê¶Âä†ÂÖ• label
   *    itemProps
   *    defaultValue Ê∏≤ÊüìÁªÑ‰ª∂ÂàùÂßãÂÄº
   *    render Ëá™ÂÆö‰πâÊ∏≤ÊüìÁªÑ‰ª∂ * (renderCallbackParams: RenderCallbackParams) => VNode / VNode[] / string
   *        export interface RenderCallbackParams {
   *          schema: FormSchema;
   *          values: any;
   *          model: any;
   *          field: string;
   *        }
   *    renderColContent Ëá™ÂÆö‰πâÊ∏≤ÊüìÁªÑ‰ª∂(ÂåÖÂê´formItem)
   *    renderComponentContent Ëá™ÂÆö‰πâÊ∏≤ÊüìÁªÑ‰ª∂ÂÜÖÈÉ®slot
   *    slot Ëá™ÂÆö‰πâ slot Ê∏≤ÊüìÁªÑ‰ª∂
   *    colSlot Ëá™ÂÆö‰πâ slot Ê∏≤ÊüìÁªÑ‰ª∂(ÂåÖÂê´ formItem)
   *    show Âà§Êñ≠ÂΩìÂâçÁªÑ‰ª∂ÊòØÂê¶ÊòæÁ§∫(css ÊéßÂà∂Ôºå‰∏ç‰ºöÂà†Èô§ dom) *
   *    ifShow Âä®ÊÄÅÂà§Êñ≠ÂΩìÂâçÁªÑ‰ª∂ÊòØÂê¶ÊòæÁ§∫Ôºåjs ÊéßÂà∂Ôºå‰ºöÂà†Èô§ dom *
   *    dynamicDisabled Âä®ÊÄÅÂà§Êñ≠ÁªÑ‰ª∂ÊòØÂê¶Á¶ÅÁî®
   */
  import { defineComponent, h, ref, reactive, toRefs, getCurrentInstance } from 'vue';
  import { PageWrapper } from '/@/components/Page';
  import { BasicTitle } from '/@/components/Basic';
  import { BasicForm, FormSchema, useForm } from '/@/components/Form';
  import { Input as AntdInput } from 'ant-design-vue';
  import { EnvironmentOutlined } from '@ant-design/icons-vue';
  import SearchAddress from '/@/views/map/advanced/components/SearchAddress.vue';

  const schemas: FormSchema[] = [
    {
      field: 'nickname',
      label: 'ÊòµÁß∞',
      subLabel: '(Â§ß‰æ†Â∞äÂßìÂ§ßÂêç)',
      labelWidth: '120',
      suffix: 'üòÇüòÇ',
      component: 'Input',
      defaultValue: 'smiling',
      // changeEvent: 'change',
      helpMessage: ['Â§ß‰æ†‰Ω†Â•Ω'],
      required: true,
      rulesMessageJoinLabel: true,
      componentProps: {
        placeholder: 'ÊµôÊ±üÁ¨¨‰∏ÄÊ∑±ÊÉÖ',
        onChange: (e) => {
          console.log('field onchange', e);
        },
      },
    },
    {
      field: 'password',
      component: 'InputPassword',
      label: 'ÂØÜÁ†Å',
      defaultValue: '123456',
      componentProps: {},
    },
    {
      field: 'render',
      label: 'renderÊ∏≤ÊüìÁªÑ‰ª∂',
      labelWidth: '140',
      component: 'Input',
      render: ({ model, field, values }) => {
        console.log('_render', model, field, values);
        // schema ÂΩìÂâçÂ≠óÊÆµ
        // model ÂΩìÂâçË°®ÂçïÊï∞ÊçÆ { fieldName: fieldValue }
        // field ÂΩìÂâçÂ≠óÊÆµÂêç
        // values Ë°®Á§∫scheme ÊâÄÊúâÊï∞ÊçÆ, ÂåÖÊã¨Êï¥‰∏™Ë°®ÂçïÈÖçÁΩÆ mergeDynamicData
        return h(AntdInput, {
          placeholder: 'ËØ∑ËæìÂÖ•',
          value: model[field] || model['asname'], // ÂÄºÁªëÂÆö, ÂèØ‰ª•ÂÆûÁé∞ÊúâÂÄº‰ΩøÁî®ÂΩìÂâçÂÄº, Êó†ÂÄº‰ΩøÁî®ÂÖ∂‰ªñÂÄº‰ª£Êõø
          onChange: (e) => {
            model[field] = e.target.value;
          },
        });
      },
    },
    {
      field: 'asname',
      label: 'Âà´Âêç',
      suffix: 'üòÑ',
      component: 'Input',
      defaultValue: 'develop',
      // required: true,
      // rulesMessageJoinLabel: true,
      componentProps: {
        placeholder: 'ÊµôÊ±üÁ¨¨‰∏ÄÂ∏Ö',
        onChange: (e) => {
          console.log('field onchange', e);
        },
      },
    },
    {
      field: 'asname233',
      label: 'Âà´Âêç233',
      suffix: 'üòÑ',
      component: 'Input',
      helpMessage: ['Ê∏©È¶®ÊèêÁ§∫', 'tm520'],
      helpComponentProps: {
        // showIndex: true,
        // color: 'red',
        fontSize: '18px',
        icon: 'üòÑ',
      },
      defaultValue: 'asname233',
      componentProps: ({ formActionType, formModel }) => {
        return {
          // xxxx props
          onChange: () => {
            console.log('_formActionType', formActionType);
            // ÈáçÁΩÆ
            // const { reload } = tableAction;
            // reload();
            // or
            // Ê∑ªÂä†ÂÖ∂‰ªñÂ±ûÊÄß
            formModel['otherVai'] = '123';
          },
        };
      },
    },
    {
      field: 'RangePicker',
      label: 'RangePicker',
      component: 'RangePicker',
      labelWidth: '120px',
    },
    {
      field: 'time',
      label: 'time',
      component: 'RangePicker',
      componentProps: {
        placeholder: ['ÂºÄÂßãÊó∂Èó¥', 'ÁªìÊùüÊó∂Èó¥'],
        format: 'hh:mm:ss',
        valueFormat: 'hh:mm:ss',
        picker: 'time',
      },
    },
    {
      field: 'year',
      label: 'year',
      component: 'DatePicker',
      required: true,
      componentProps: {
        placeholder: 'Please select year',
        format: 'YYYY',
        valueFormat: 'YYYY',
        picker: 'year', //  picker Â±ûÊÄß
        style: {
          width: '100%',
        },
        disabled: false,
      },
      defaultValue: '2022',
    },
    {
      field: 'year2',
      label: 'year2',
      component: 'RangePicker',
      componentProps: {
        placeholder: ['ÂºÄÂßãÂπ¥‰ªΩ', 'ÁªìÊùüÂπ¥‰ªΩ'],
        picker: 'year',
        valueFormat: 'YYYY',
        defaultValue: ['2009', '2022'],
      },
      dynamicDisabled: ({ values }) => {
        console.log(values.year);
        return !!values.year;
      },
    },
    {
      field: 'InputCountDown',
      label: 'InputCountDown',
      component: 'InputCountDown',
      labelWidth: '120px',
    },
    {
      field: 'InputSearch',
      label: 'InputSearch',
      component: 'InputSearch',
      labelWidth: '120px',
    },
    {
      field: 'TimePicker',
      label: 'TimePicker',
      component: 'TimePicker',
      labelWidth: '120px',
    },
    {
      field: 'StrengthMeter',
      label: 'StrengthMeter',
      component: 'StrengthMeter',
      labelWidth: '120px',
    },
    {
      field: 'Switch',
      label: 'Switch',
      component: 'Switch',
      labelWidth: '120px',
    },
    {
      field: 'customSlot',
      label: 'customSlot',
      component: 'Input',
      slot: 'customSlot',
    },
    {
      field: 'address',
      label: 'address',
      component: 'Input',
      rules: [{ required: true }],
      render: ({ model, field }) => {
        return h(AntdInput, {
          placeholder: 'ËØ∑ËæìÂÖ•',
          value: model[field],
          onChange: (e) => {
            model[field] = e.target.value;
          },
        });
      },
      // ifShowÂà§Êñ≠, js Â§ÑÁêÜËäÇÁÇπ
      ifShow: ({ values }) => {
        console.log(values);
        return values.renderComponentContent;
      },
    },
    {
      field: 'renderComponentContent',
      label: 'renderComponentContent',
      labelWidth: '200px',
      component: 'Input',
      rules: [{ required: true, message: 'ËØ∑ÈÄâÊã©Âú∞ÂùÄ' }],
      componentProps: {
        placeholder: 'ËØ∑ËæìÂÖ•ÂÜÖÂÆπ',
      },
      // Ê∏≤ÊüìÁªÑ‰ª∂ÂÜÖÂÆπ
      renderComponentContent: ({ values }) => {
        return {
          prefix: () => '‰ΩçÁΩÆ:',
          suffix: h(EnvironmentOutlined, {
            onClick() {
              console.log('TODO: ‰ΩçÁΩÆÈÄâÊã©', values);
              const _this = getCurrentInstance() as any;
              _this.handleShowAddress();
            },
          }),
        };
      },
    },
    {
      field: 'field',
      component: 'ApiSelect',
      label: 'Â≠óÊÆµ',
    },
    {
      field: 'RadioButtonGroup',
      component: 'RadioButtonGroup',
      componentProps: {
        options: [
          {
            label: 'Êª¥Êª¥',
            value: '11',
          },
          {
            label: 'Êª¥Êª¥2',
            value: '22',
            disabled: false,
          },
          {
            label: 'Êª¥Êª¥3',
            value: '33',
            disabled: true,
          },
        ],
      },
      label: 'Â≠óÊÆµ',
    },
    {
      field: 'RadioGroup233',
      label: 'ÂçïÈÄâ',
      component: 'RadioGroup',
      componentProps: {
        options: [
          {
            label: 'Êª¥Êª¥',
            value: '11',
          },
          {
            label: 'Êª¥Êª¥2',
            value: '22',
            disabled: false,
          },
          {
            label: 'Êª¥Êª¥3',
            value: '33',
            disabled: true,
          },
        ],
      },
    },
    {
      field: 'CheckboxGroup',
      label: 'Â§öÈÄâ',
      component: 'CheckboxGroup',
      componentProps: {
        options: [
          {
            label: 'Êª¥Êª¥',
            value: '1',
          },
          {
            label: 'Êª¥Êª¥2',
            value: '2',
            disabled: false,
          },
          {
            label: 'Êª¥Êª¥3',
            value: '33',
            disabled: true,
          },
        ],
      },
      // CheckboxGroup
    },
  ];

  export default defineComponent({
    components: {
      PageWrapper,
      BasicForm,
      BasicTitle,
      SearchAddress,
    },
    setup() {
      // register Áî®‰∫éÊ≥®ÂÜå useFormÔºåÂ¶ÇÊûúÈúÄË¶Å‰ΩøÁî® useForm Êèê‰æõÁöÑ apiÔºåÂøÖÈ°ªÂ∞Ü register ‰º†ÂÖ•ÁªÑ‰ª∂ÁöÑ onRegister
      // ÂèÇÊï∞ props ÂÜÖÁöÑÂÄºÂèØ‰ª•ÊòØ computed ÊàñËÄÖ ref Á±ªÂûã
      const searchAddressRef = ref<any>(null);
      const positionData = reactive({
        lng: '',
        lat: '',
        address: '',
      });

      const [register, { setProps }] = useForm({
        labelWidth: 80,
        schemas,
        actionColOptions: {
          span: 24,
        },
        // È¢ùÂ§ñ‰º†ÈÄíÂà∞Â≠êÁªÑ‰ª∂ÁöÑÂèÇÊï∞ values
        mergeDynamicData: {
          anthorVari: 124,
        },
        compact: true, // Á¥ßÂáëÁ±ªÂûãË°®Âçï, ÂáèÂ∞ë margin-bottom
        size: 'large', //  Ë°®Âçïsize
        // showActionButtonGroup: false, // ÊòØÂê¶Â±ïÁ§∫Êìç‰Ωú[ÈáçÁΩÆ|Êèê‰∫§]ÊåâÈíÆ, ÈªòËÆ§ true
        // showResetButton: true, // ÊòØÂê¶Â±ïÁ§∫ÈáçÁΩÆ
        // resetButtonOptions: {}, // ÈáçÁΩÆÈÖçÁΩÆ
        // resetFunc: () => Promise.resolve(), // Ëá™ÂÆö‰πâÈáçÁΩÆÈÄªËæë
        // showSubmitButton: true, // ÊòØÂê¶Â±ïÁ§∫Êèê‰∫§
        // submitButtonOptions: {}, // Êèê‰∫§ÈÖçÁΩÆ
        // submitFunc: () => Promise.resolve(), //  Ëá™ÂÆö‰πâÊèê‰∫§ÈÄªËæë
        // fieldMapToTime: [
        //   // Â∞ÜË°®ÂçïÂÜÖÊó∂Èó¥Âå∫ÂüüÁöÑÂÄºÊò†Â∞ÑÊàê 2 ‰∏™Â≠óÊÆµ, Ê†ºÂºèÂèÇËÄÉ moment
        //   ['datetime', ['startTime', 'endTime'], 'YYYY-MM-DD'],
        //   ['datetime1', ['startTime1', 'endTime1'], 'YYYY-MM-DD HH:mm:ss'],
        // ],
      });

      return {
        register,
        setProps,
        schemas,
        handleSubmit: (values: any) => {
          console.log('_handleSubmit', values);
        },
        onSearchAddressConfirm: (data) => {
          console.log('_onSearchAddressConfirm', data);
        },
        searchAddressRef,
        handleShowAddress: () => {
          searchAddressRef.value.init({
            address: positionData.address,
            lng: positionData.lng,
            lat: positionData.lat,
          });
        },
        ...toRefs(positionData),
      };
    },
  });
</script>

<style lang="scss" scoped>
  .main {
    padding: 16px;
  }
</style>
